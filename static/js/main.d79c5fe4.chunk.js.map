{"version":3,"sources":["components/NumberInput/NumberInput.tsx","components/RestartConfig/RestartConfig.tsx","components/Cell/Cell.tsx","components/Board/BoardHelpers.ts","components/Board/Board.tsx","components/StickyButton/StickyButton.tsx","components/Stats/Stats.tsx","components/App/App.tsx","serviceWorker.ts","index.tsx"],"names":["NumberInput","name","label","value","onChange","min","max","enabled","Boolean","className","type","disabled","defaultProps","initConfig","Object","freeze","width","height","mines","RestartConfig","restart","useState","config","setConfig","input","currentTarget","parseInt","newConfig","maxMines","Math","onSubmit","event","preventDefault","Cell","cell","xray","onClick","onMouseDown","onMouseUp","flagged","pressed","pressedClass","symbol","neighbors","board","c","cellFn","forEach","deltaRow","deltaCell","neighbor","row","initBoard","Array","fill","map","floor","random","setCell","newValue","newBoard","Board","restartFlag","flags","setFlags","setAlert","gameState","setGameState","setBoard","coordinateKey","useEffect","pressCell","initC","copyBoard","queue","length","shift","neighborC","push","floodEmptyCells","renderCell","key","shiftKey","flagsNew","boardNew","cellFlaggedOk","every","allMinesFlagged","toggleFlag","rowIndex","_","StickyButton","setPressed","Stats","setXray","alert","flagsRemaining","setRestartFlag","isLocalhost","window","location","hostname","match","registerValidSW","swUrl","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","console","log","onUpdate","onSuccess","catch","error","render","StrictMode","document","getElementById","URL","process","href","origin","addEventListener","fetch","headers","response","contentType","get","status","indexOf","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.d79c5fe4.chunk.js","sourcesContent":["// A \"Seven segment\" number input, either with onChange callback or disabled.\n\nimport React from 'react';\n\nimport './NumberInput.scss';\n\ntype Props = {\n  name: string;\n  label: string;\n  value: number;\n  onChange: (event: React.FormEvent<HTMLInputElement>) => void;\n  min: number;\n  max: number;\n};\nfunction NumberInput({ name, label, value, onChange, min, max }: Props) {\n  // Disable the input when there's no onChange callback.\n  const enabled = Boolean(onChange);\n\n  return (\n    <label className=\"number-input\">\n      {label}\n      <input\n        name={name}\n        type=\"number\"\n        value={value}\n        onChange={onChange}\n        min={min}\n        max={max}\n        disabled={!enabled}\n      />\n    </label>\n  );\n}\n\nNumberInput.defaultProps = {\n  name: null,\n  onChange: null,\n  min: null,\n  max: null,\n};\n\nexport default NumberInput;\n","// Handles the restart game form (Width, Height, Mines and restart button).\n\nimport React, { useState } from 'react';\nimport NumberInput from '../NumberInput/NumberInput';\n\nimport './RestartConfig.scss';\n\n// Board boundaries\nconst MIN_SIZE = 1;\nconst MAX_SIZE = 300;\n\n// Default config\nexport type TConfig = {\n  width: number;\n  height: number;\n  mines: number;\n};\n\nexport const initConfig: TConfig = Object.freeze({\n  width: 10,\n  height: 10,\n  mines: 15,\n});\n\ntype Props = {\n  restart(config: TConfig): void;\n};\n\nexport default function RestartConfig({ restart }: Props) {\n  const [config, setConfig] = useState(initConfig);\n\n  const onChange = ({ currentTarget }: React.FormEvent<HTMLInputElement>) => {\n    const input = currentTarget;\n\n    // Ignore empty string.\n    if (input.value === '') return;\n\n    // Ignore the new value when it's out of bounds.\n    if (input.value < input.min || input.value > input.max) return;\n\n    const value = parseInt(input.value);\n    const newConfig: TConfig = { ...config };\n    // FIXME: How to assign to newConfig[input.name] in a typesafe way without listing all options?\n    switch (input.name) {\n      case 'width':\n        newConfig.width = value;\n        break;\n      case 'height':\n        newConfig.height = value;\n        break;\n      case 'mines':\n        newConfig.mines = value;\n        break;\n    }\n    setConfig(newConfig);\n  };\n\n  const onSubmit = (event: React.FormEvent) => {\n    event.preventDefault();\n    restart(config);\n  };\n\n  // Require at least one cell without a mine, and don't allow more than 999,\n  // so the number input design doesn't break.\n  const maxMines = Math.min(config.width * config.height - 1, 999);\n\n  return (\n    <form onSubmit={onSubmit} className=\"restart-config\">\n      <NumberInput\n        name=\"width\"\n        label=\"Width\"\n        value={config.width}\n        onChange={onChange}\n        min={MIN_SIZE}\n        max={MAX_SIZE}\n      />\n\n      <NumberInput\n        name=\"height\"\n        label=\"Height\"\n        value={config.height}\n        onChange={onChange}\n        min={MIN_SIZE}\n        max={MAX_SIZE}\n      />\n\n      <NumberInput\n        name=\"mines\"\n        label=\"Mines\"\n        value={config.mines}\n        onChange={onChange}\n        min={1}\n        max={maxMines}\n      />\n\n      <label>\n        Restart\n        <button type=\"submit\" className=\"restart embossed\">\n          <span className=\"smiley\" />\n        </button>\n      </label>\n    </form>\n  );\n}\n","import React from 'react';\n\nimport './Cell.scss';\n\nexport type TCell = {\n  flagged: boolean;\n  value: number;\n  pressed: boolean;\n};\n\nexport const CELL_EMPTY = 0;\nexport const CELL_MINE = -1;\n\ntype Props = {\n  cell: TCell;\n  xray: boolean;\n  onClick: (event: React.MouseEvent) => void;\n  onMouseDown: (event: React.MouseEvent) => void;\n  onMouseUp: (event: React.MouseEvent) => void;\n};\nfunction Cell({ cell, xray, onClick, onMouseDown, onMouseUp }: Props) {\n  const { flagged, value, pressed } = cell;\n\n  const symbol = () => {\n    if (flagged) return <span className=\"flag\">f</span>;\n\n    if (!xray && !pressed) return <></>;\n\n    switch (value) {\n      case CELL_MINE:\n        return <span className=\"mine\">X</span>;\n\n      case CELL_EMPTY:\n        return <></>;\n\n      default:\n        return <span className={`color-${value}`}>{value}</span>;\n    }\n  };\n\n  const pressedClass = () => {\n    // Returning undefined instead of empty string to avoid printing class=\"\"\n    // on all cells.\n    if (!pressed) return undefined;\n    if (value === CELL_MINE) return 'flat mine';\n    return 'flat';\n  };\n\n  return (\n    <button\n      className={pressedClass()}\n      onClick={onClick}\n      onMouseDown={onMouseDown}\n      onMouseUp={onMouseUp}\n    >\n      {symbol()}\n    </button>\n  );\n}\n\nexport default Cell;\n","import { CELL_EMPTY, CELL_MINE, TCell } from '../Cell/Cell';\n\nexport type TCoordinate = { row: number; cell: number };\n\ntype TBoard = TCell[][];\n\n// Run a callback on non-mine neighbors of a cell.\nfunction neighbors(\n  board: TBoard,\n  c: TCoordinate,\n  cellFn: (cell: TCell, c: TCoordinate) => void\n) {\n  [-1, 0, 1].forEach((deltaRow) => {\n    [-1, 0, 1].forEach((deltaCell) => {\n      if (!deltaRow && !deltaCell) return;\n\n      const neighbor = { row: c.row + deltaRow, cell: c.cell + deltaCell };\n\n      // Ignore coordinates out of bounds.\n      if (!board[neighbor.row] || !board[neighbor.row][neighbor.cell]) return;\n\n      if (board[neighbor.row][neighbor.cell].value !== CELL_MINE) {\n        cellFn(board[neighbor.row][neighbor.cell], neighbor);\n      }\n    });\n  });\n}\n\n// Create new board with random mines.\nexport function initBoard(\n  width: number,\n  height: number,\n  mines: number\n): TBoard {\n  // FIXME: What's a nice way to init a matrix of objects?\n  const board = Array(height)\n    .fill(null)\n    .map(() =>\n      Array(width)\n        .fill(null)\n        .map(() => ({\n          pressed: false,\n          value: 0,\n          flagged: false,\n        }))\n    );\n\n  // Plant mines.\n  [...Array(mines)].forEach(() => {\n    // Keep creating random coordinates until an empty spot is found, then add\n    // a mine there.\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      const c = {\n        row: Math.floor(Math.random() * height),\n        cell: Math.floor(Math.random() * width),\n      };\n\n      if (board[c.row][c.cell].value !== CELL_MINE) {\n        board[c.row][c.cell].value = CELL_MINE;\n\n        neighbors(board, c, (cell) => {\n          // eslint-disable-next-line no-param-reassign\n          cell.value += 1;\n        });\n        break;\n      }\n    }\n  });\n  return board;\n}\n\n// Return a copy of the board, with one cell changed.\nexport function setCell(\n  board: TBoard,\n  c: TCoordinate,\n  pressed: boolean,\n  value: number | null,\n  flagged: boolean\n): TBoard {\n  const newValue = value === null ? board[c.row][c.cell].value : value;\n  const newBoard = [...board];\n  newBoard[c.row] = [...board[c.row]];\n  newBoard[c.row][c.cell] = { pressed, value: newValue, flagged };\n\n  return newBoard;\n}\n\n// Create a copy of the board.\nfunction copyBoard(board: TBoard): TBoard {\n  return board.map((row) =>\n    row.map((cell) => ({\n      pressed: cell.pressed,\n      value: cell.value,\n      flagged: cell.flagged,\n    }))\n  );\n}\n\n// Revealing the neighbors of empty cells.\nexport function floodEmptyCells(board: TBoard, initC: TCoordinate): TBoard {\n  const newBoard = copyBoard(board);\n\n  // For each empty cell, adding all of its empty neighbors to a queue, and\n  // repeating until the queue is empty.\n  // Initialize the queue with the empty cell clicked.\n  const queue: TCoordinate[] = [initC];\n  while (queue.length) {\n    const c = queue.shift();\n    // This condition is just to satisfy the compiler. The queue is only\n    // shifted when not empty.\n    if (!c) break;\n\n    if (newBoard[c.row][c.cell].pressed) {\n      continue;\n    }\n\n    newBoard[c.row][c.cell].pressed = true;\n\n    neighbors(newBoard, c, (neighbor, neighborC) => {\n      if (neighbor.flagged) return;\n\n      // Reveal cell neighbors.\n      // eslint-disable-next-line no-param-reassign\n      if (neighbor.value > CELL_EMPTY) neighbor.pressed = true;\n\n      // Add empty cells to the flood queue.\n      if (neighbor.value === CELL_EMPTY) queue.push(neighborC);\n    });\n  }\n  return newBoard;\n}\n\n// Checks that each cell is either not a mine or a flagged mine.\nexport function allMinesFlagged(board: TBoard): boolean {\n  const cellFlaggedOk = ({ flagged, value }: TCell) =>\n    value !== CELL_MINE || (value === CELL_MINE && flagged);\n\n  return board.every((row) => row.every(cellFlaggedOk));\n}\n","import React, { useState, useEffect } from 'react';\n\nimport Cell, { CELL_EMPTY, CELL_MINE, TCell } from '../Cell/Cell';\nimport {\n  initBoard,\n  allMinesFlagged,\n  setCell,\n  floodEmptyCells,\n  TCoordinate,\n} from './BoardHelpers';\n\nimport './Board.scss';\n\nexport type GameState = 'clicking' | 'ongoing' | 'won' | 'lost';\n\ntype Props = {\n  restartFlag: boolean;\n  width: number;\n  height: number;\n  mines: number;\n  xray: boolean;\n  flags: number;\n  setFlags: (flags: number) => void;\n  setAlert: (alert: string) => void;\n  gameState: GameState;\n  setGameState: (state: GameState) => void;\n};\n\nexport default function Board({\n  restartFlag,\n  width,\n  height,\n  mines,\n  xray,\n  flags,\n  setFlags,\n  setAlert,\n  gameState,\n  setGameState,\n}: Props) {\n  const [board, setBoard] = useState(initBoard(width, height, mines));\n\n  const coordinateKey = (c: TCoordinate) => `${c.row}_${c.cell}`;\n\n  // Rebuild the board when the config changes, or when new game is started\n  // (restart flag flips).\n  useEffect(() => {\n    setBoard(initBoard(width, height, mines));\n  }, [restartFlag, width, height, mines]);\n\n  const pressCell = (c: TCoordinate) => {\n    // Ignore press on flagged and pressed cells.\n    const { flagged, pressed, value } = board[c.row][c.cell];\n    if (flagged || pressed) return;\n\n    switch (value) {\n      case CELL_MINE:\n        setGameState('lost');\n        setBoard(setCell(board, c, true, null, false));\n        setAlert('game over');\n        break;\n\n      case CELL_EMPTY:\n        // \"Flood fill\" empty cells.\n        setBoard(floodEmptyCells(board, c));\n        break;\n\n      default:\n        // Pressed a mine neighbour. Mark it as pressed.\n        setBoard(setCell(board, c, true, null, false));\n    }\n  };\n\n  const toggleFlag = (c: TCoordinate) => {\n    const { flagged, pressed } = board[c.row][c.cell];\n\n    // Don't allow flagging pressed cells.\n    if (pressed) return;\n    // Don't allow adding more flags than mines.\n    if (!flagged && mines <= flags) {\n      setAlert('no more flags');\n      return;\n    }\n    // Clear the \"no flags\" alert, update the flags counter and toggle the flag\n    // on the board.\n    setAlert('');\n    const flagsNew = flags + (flagged ? -1 : 1);\n    setFlags(flagsNew);\n    const boardNew = setCell(board, c, false, null, !flagged);\n    setBoard(boardNew);\n    // Check if all mines are flagged correctly when all flags are used.\n    if (flagsNew === mines && allMinesFlagged(boardNew)) {\n      setGameState('won');\n      setAlert('game won');\n    }\n  };\n\n  const renderCell = (c: TCoordinate) => {\n    const onClick = (event: React.MouseEvent) => {\n      if (gameState !== 'ongoing') return;\n\n      if (event.shiftKey) toggleFlag(c);\n      else pressCell(c);\n    };\n\n    const onMouseDown = (event: React.MouseEvent) => {\n      if (gameState !== 'ongoing' || event.shiftKey) return;\n      setGameState('clicking');\n    };\n\n    const onMouseUp = () => {\n      if (gameState !== 'clicking') return;\n      setGameState('ongoing');\n    };\n\n    return (\n      <Cell\n        key={coordinateKey(c)}\n        cell={board[c.row][c.cell]}\n        xray={xray}\n        onClick={onClick}\n        onMouseDown={onMouseDown}\n        onMouseUp={onMouseUp}\n      />\n    );\n  };\n\n  const renderRow = (row: TCell[], rowIndex: number) => (\n    <div key={rowIndex} className=\"row\">\n      {row.map((_, cell) => renderCell({ row: rowIndex, cell }))}\n    </div>\n  );\n\n  return <div className=\"board debossed\">{board.map(renderRow)}</div>;\n}\n","// A toggleable button.\n\nimport React from 'react';\n\nimport './StickyButton.scss';\n\ntype Props = {\n  label: string;\n  pressed: boolean;\n  setPressed: (p: boolean) => void;\n};\nfunction StickyButton({ label, pressed, setPressed }: Props) {\n  const pressedClass = pressed ? 'debossed' : 'embossed';\n\n  const onClick = () => setPressed(!pressed);\n\n  return (\n    <button className={`sticky-button ${pressedClass}`} onClick={onClick}>\n      {label}\n    </button>\n  );\n}\n\nexport default StickyButton;\n","// Handles status messages and configs that can be changed without restarting.\n\nimport React from 'react';\n\nimport NumberInput from '../NumberInput/NumberInput';\nimport StickyButton from '../StickyButton/StickyButton';\n\nimport './Stats.scss';\n\ntype Props = {\n  flags: number;\n  mines: number;\n  xray: boolean;\n  setXray: (xray: boolean) => void;\n  alert: string;\n};\nexport default function Stats({ flags, mines, xray, setXray, alert }: Props) {\n  const flagsRemaining = mines - flags;\n\n  return (\n    <section className=\"stats\">\n      <NumberInput label=\"Flags\" value={flagsRemaining} />\n\n      <StickyButton label=\"X-ray\" pressed={xray} setPressed={setXray} />\n\n      <p className=\"alert\">{alert}</p>\n    </section>\n  );\n}\n","// App renders the main game markup, and manages the global states.\n\nimport React, { useState } from 'react';\nimport RestartConfig, {\n  TConfig,\n  initConfig,\n} from '../RestartConfig/RestartConfig';\nimport Board, { GameState } from '../Board/Board';\nimport Stats from '../Stats/Stats';\n\nimport './App.scss';\n\nexport default function () {\n  // Board() initiates the board when this flag changes. There's no meaning to\n  // its value.\n  const [restartFlag, setRestartFlag] = useState(false);\n\n  // The config state is held separately inside RestartConfig(), to allow\n  // adjusting the inputs and only change the board after restart.\n  const [config, setConfig] = useState(initConfig);\n\n  // Count flags currently in use.\n  const [flags, setFlags] = useState(0);\n\n  // Alert for allowing the Board to display text messages on Stats().\n  const [alert, setAlert] = useState('');\n\n  // Track the game state (won | lost | ongoing), for the smiley on the\n  // start button, and for locking the cells when game is over.\n  const [gameState, setGameState] = useState<GameState>('ongoing');\n\n  // For the \"Superman mode\".\n  const [xray, setXray] = useState(false);\n\n  // Start a new game: Change restartFlag and reset other states.\n  const restart = (newConfig: TConfig) => {\n    setRestartFlag(!restartFlag);\n    setConfig(newConfig);\n    setFlags(0);\n    setAlert('');\n    setGameState('ongoing');\n  };\n\n  return (\n    <section className={`app embossed ${gameState}`}>\n      <header>\n        <div className=\"debossed settings\">\n          <RestartConfig restart={restart} />\n          <Stats\n            flags={flags}\n            mines={config.mines}\n            xray={xray}\n            setXray={setXray}\n            alert={alert}\n          />\n        </div>\n      </header>\n\n      <Board\n        restartFlag={restartFlag}\n        width={config.width}\n        height={config.height}\n        mines={config.mines}\n        xray={xray}\n        flags={flags}\n        setFlags={setFlags}\n        setAlert={setAlert}\n        gameState={gameState}\n        setGameState={setGameState}\n      />\n    </section>\n  );\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n//\n// export function unregister() {\n//   if ('serviceWorker' in navigator) {\n//     navigator.serviceWorker.ready\n//       .then((registration) => {\n//         registration.unregister();\n//       })\n//       .catch((error) => {\n//         console.error(error.message);\n//       });\n//   }\n// }\n","import React from 'react';\nimport { render } from 'react-dom';\nimport App from './components/App/App';\nimport { register } from './serviceWorker';\n\nimport 'reset-css';\nimport './fonts/fonts.scss';\n\nrender(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\nregister();\n"],"sourceRoot":""}